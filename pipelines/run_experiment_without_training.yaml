---
variables:
  dataset: &dataset CUB
  backbone: &backbone Conv4
  method: &method protonet
  train_aug: &train_aug True
  train_n_way: &train_n_way 5
  test_n_way: &test_n_way 5
  n_shot: &n_shot 1
  split: &split novel
  save_iter: &save_iter -1

init:

  flows:

    method_training_flow:
      steps:
      - name: FetchModel
        init:
          path_to_model: output/../458/CUB/Conv4/protonet_aug_5way_1shot/best_model.tar

    embedding_flow:
      inputs: method_training_flow
      steps:
      - name: Embedding
        init:
          dataset: *dataset
          backbone: *backbone
          method: *method
          train_n_way: *train_n_way
          test_n_way: *test_n_way
          n_shot: *n_shot
          train_aug: *train_aug
          split: *split
          save_iter: *save_iter
          shallow: False

    method_evaluation_flow:
      inputs:
        - method_training_flow
        - embedding_flow
      steps:
        - name: MethodEvaluation
          init:
            dataset: *dataset
            backbone: *backbone
            method: *method
            train_n_way: *train_n_way
            test_n_way: *test_n_way
            n_shot: *n_shot
            train_aug: *train_aug
            split: *split
            save_iter: *save_iter
            n_iter: 600
            adaptation: False

run:
  output_folder: output
  output_folder_permissions: 02775
