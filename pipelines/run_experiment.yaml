---
variables:
  output_folder: save_dir
  dataset: &dataset CUB
  backbone: &backbone Conv4
  method: &method matchingnet

init:

  flows:

    method_training_flow:
      steps:
      - name: MethodTraining
        init:
          dataset: *dataset
          backbone: *backbone
          method: *method
          num_classes: 4412
          stop_epoch: 1
          shallow: True

    embedding_flow:
      inputs: method_training_flow
      steps:
      - name: Embedding
        init:
          dataset: *dataset
          backbone: *backbone
          method: *method

    method_evaluation_flow:
      inputs:
        - method_training_flow
        - embedding_flow
      steps:
        - name: MethodEvaluation
          init:
            dataset: *dataset
            backbone: *backbone
            method: *method
            n_iter: 1

run:
  output_folder: %(output_folder)s/%(dataset)s/%(backbone)s/%(method)s
  output_folder_permissions: 02775
